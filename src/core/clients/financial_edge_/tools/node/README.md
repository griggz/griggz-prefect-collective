# Tools

## Name: sky-api-auth-code-generator
## Description: 
#### Every API call requires two items, `subscription_key` and `access_token`. The `subscription_key` can be found in your developer_account page (https://developer.blackbaud.com/subscriptions/) and your `access_token` is generated by following the steps below. Using the access-tokens generated on the site only grants you access to the api for 60min. In order to generate a new access-token, the "Authorization Code Flow" process must be followed (https://developer.blackbaud.com/skyapi/docs/authorization/auth-code-flow/tutorial). 

#### This node tool is used to perform the following ACTIONS: 

- Request Token
- Refresh access token

## How to Use: 

#### Step 1: `cd src/finMid/services/skyapi/tools/node`
#### Step 2: If refresh token is expired, use the following url to obtain a new code and follow the prompts in the browswer (login + approve), otherwise skip to Step 7.
```
Provide the args without quotes and enter the full request url below into the browser.
https://oauth2.sky.blackbaud.com/authorization?client_id='check your .env'&response_type=code&redirect_uri='check your dev account'&state=fdf80155
```
#### Step 3: Check your local server for a `GET` response. Here is what it will look like: `GET /admin/?code=CODENUMS&state=STATENUMS HTTP/1.1" 200 577`
#### Step 4: Update your .env file with the new CODE for each the environments
#### Step 5: `node get_access_token.js` and wait for return
#### Step 6: Update your .env files or user accounts with the new refresh token. This refresh token will be good for 365 days.
#### Step 7: `node refresh_access_token.js`
#### Step 8: `cd ..` back to `src/`
#### Step 9: Run test to ensure new access token works `python manage.py test sfpipe.tests.SkyApiTestCase` and check to ensure response has data.
